@using Klimaci.DTO.BlogDTOs
@using Klimaci.Entity

@model BlogPostAddDTO
@{
    ViewData["Title"] = "Yeni Yazı";
    Layout = "~/Areas/Admin/Views/Shared/_AdminLayout.cshtml";
    var cats = (IEnumerable<Category>)(ViewBag.Categories ?? Enumerable.Empty<Category>());
    var tags = (IEnumerable<Tag>)(ViewBag.Tags ?? Enumerable.Empty<Tag>());
}
<div class="container py-3">
    <h1>Yeni Yazı</h1>
    @await Html.PartialAsync("~/Areas/Admin/Views/Shared/_AdminAlerts.cshtml")
    <form asp-action="Create" method="post" enctype="multipart/form-data" class="vstack gap-3">
        <div class="row g-3">
            <div class="col-lg-8">
                <label class="form-label">Başlık</label>
                <input asp-for="Title" class="form-control" id="title" />
                <label class="form-label mt-2">Özet</label>
                <textarea asp-for="Summary" rows="3" class="form-control"></textarea>
                <label class="form-label mt-2">İçerik</label>
                <textarea asp-for="Content" rows="10" class="form-control"></textarea>
                <label class="form-label mt-2">Yayın Tarihi</label>
                <input asp-for="PublishDate" type="date" class="form-control" />
            </div>
            <div class="col-lg-4">
                <label class="form-label">Kategoriler</label>
                <select asp-for="CategoryIds" class="form-select" multiple size="6">
                    @foreach (var c in cats)
                    {
                        <option value="@c.Id">@c.Title</option>
                    }
                </select>
                <label class="form-label mt-2">Etiketler</label>
                <select asp-for="TagIds" class="form-select" multiple size="6">
                    @foreach (var t in tags)
                    {
                        <option value="@t.Id">@t.Title</option>
                    }
                </select>

                <label class="form-label mt-2">Slug</label>
                <div class="input-group">
                    <input asp-for="Slug" class="form-control" id="slug" />
                    <button type="button" class="btn btn-outline-secondary" id="btnSlug">Kontrol</button>
                </div>
                <div class="form-text" id="slugHint"></div>

                <label class="form-label mt-2">SEO Title</label>
                <input asp-for="SeoTitle" class="form-control" />
                <label class="form-label mt-2">SEO Description</label>
                <textarea asp-for="SeoDescription" rows="2" class="form-control"></textarea>

                <div class="row g-3 mt-2">
                    <div class="col-6"><label class="form-label">Sıra</label><input asp-for="DisplayOrder" class="form-control" /></div>
                    <div class="col-6 d-flex align-items-end"><div class="form-check"><input class="form-check-input" asp-for="IsPublished" /><label class="form-check-label" for="IsPublished">Yayında</label></div></div>
                </div>

                <div class="mt-3">
                    <label class="form-label">Görseller</label>
                    <input type="file" name="files" multiple class="form-control" />
                </div>
            </div>
        </div>
        <div class="mt-3 d-flex gap-2">
            <button class="btn btn-primary">Kaydet</button>
            <a asp-action="Index" class="btn btn-light">Geri</a>
        </div>
        @Html.AntiForgeryToken()
    </form>
</div>

@section Scripts {
    <script>
        async function slugCheck(){
          const title=document.getElementById('title').value||'';
          const slug=document.getElementById('slug').value||'';
          const res=await fetch('@Url.Action("SlugCheck")',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({title,slug,excludeId:null})});
          const d=await res.json(); const input=document.getElementById('slug'); const hint=document.getElementById('slugHint');
          input.value=d.finalSlug||d.FinalSlug; const ok=d.isUnique??d.IsUnique; hint.textContent= ok?'Uygun.':'Çakışma vardı, düzeltildi.'; hint.className= ok?'form-text text-success':'form-text text-warning';
        }
        document.getElementById('btnSlug').addEventListener('click', slugCheck);
        document.getElementById('title').addEventListener('blur', ()=>{ if(!document.getElementById('slug').value) slugCheck();});
    </script>
}
